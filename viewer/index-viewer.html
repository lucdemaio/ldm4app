<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LDM Soccer Viewer</title>
  <meta name="theme-color" content="#07364f">
  <link rel="manifest" href="/viewer/manifest.json">
  <style>
    :root{--bg:#07364f;--accent:#1fb6a1;--muted:#b1c6d6;--card-bg:rgba(255,255,255,0.05)}
    body{margin:0;font-family:system-ui,sans-serif;background:#072a3a;color:#e9f4fb}
    .wrap{max-width:900px;margin:auto;padding:16px}
    .card{background:var(--card-bg);padding:15px;border-radius:12px;margin-bottom:15px;border:1px solid rgba(255,255,255,0.1)}
    .athlete-grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(250px, 1fr));gap:12px}
    .athlete-card{background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;border-left:4px solid var(--accent)}
    .status-expired{color:#ff4d4d;font-weight:bold}
    .btn{background:var(--accent);border:none;color:#fff;padding:10px 20px;border-radius:8px;cursor:pointer;font-weight:bold}
    input[type=file]{margin:10px 0;display:block}
    h2{border-bottom:1px solid var(--accent);padding-bottom:5px}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="card">
      <h1>LDM Soccer Viewer</h1>
      <p class="muted">Carica il tuo file backup JSON per visualizzare la squadra.</p>
      <input type="file" id="uploadJson" accept=".json">
    </header>

    <main id="content"></main>
  </div>

  <script>
    // Registrazione Service Worker per PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/viewer/sw.js').then(reg => {
          console.log('SW registrato con successo!', reg.scope);
        });
      });
    }

    const fileInput = document.getElementById('uploadJson');
    const contentDiv = document.getElementById('content');

    fileInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          renderData(data);
        } catch (err) {
          alert("Errore nel caricamento del file JSON");
        }
      };
      reader.readAsText(file);
    });

    function renderData(data) {
      let html = `<h2>Atleti (${data.athletes ? data.athletes.length : 0})</h2>`;
      html += `<div class="athlete-grid">`;
      
      if(data.athletes) {
        data.athletes.forEach(a => {
          const isExpired = new Date(a.medicalExpiry) < new Date();
          html += `
            <div class="athlete-card">
              <strong>${a.firstName} ${a.lastName}</strong><br>
              <small>Ruolo: ${a.role}</small><br>
              <small class="${isExpired ? 'status-expired' : ''}">
                Scadenza Medica: ${a.medicalExpiry}
              </small>
            </div>`;
        });
      }
      
      html += `</div>`;
      contentDiv.innerHTML = html;
    }
  </script>
</body>
</html>